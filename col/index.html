<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Calculadora de Divisas iPhone Style</title>
  <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #232323; font-family: 'SF Pro Display', Arial, sans-serif; }
    .noselect { user-select: none; }
  </style>
</head>
<body class="noselect">
<div id="root"></div>
<script>
const monedas = [
  { code: "BOB", name: "Boliviano", flag: "https://flagcdn.com/bo.svg" },
  { code: "USD", name: "US Dollar", flag: "https://flagcdn.com/us.svg" },
  { code: "EUR", name: "Euro", flag: "https://flagcdn.com/eu.svg" },
  { code: "GBP", name: "Libra Esterlina", flag: "https://flagcdn.com/gb.svg" },
  { code: "ARS", name: "Peso Argentino", flag: "https://flagcdn.com/ar.svg" },
  { code: "CLP", name: "Peso Chileno", flag: "https://flagcdn.com/cl.svg" },
  { code: "BRL", name: "Real Brasileño", flag: "https://flagcdn.com/br.svg" },
  { code: "PEN", name: "Sol Peruano", flag: "https://flagcdn.com/pe.svg" }
];

let ratesUSD = {}; // USD -> otras
let rateBOBtoUSD = null; // BOB -> USD (tu API)
let lastInput = "BOB";
let inputAmount = "1";
let apiError = false;

async function cargarTasas() {
  try {
    // 1. Tu API de dólar paralelo (BOB→USD)
    const res = await fetch("https://dolar-api-bolivia.onrender.com/dolar-paralelo");
    const data = await res.json();
    // 1 BOB = 1/compra_bs USD
    rateBOBtoUSD = 1 / parseFloat(data.compra_bs);

    // 2. API Frankfurter: USD -> otras monedas
    const url = "https://api.frankfurter.app/latest?from=USD&to=EUR,GBP,ARS,CLP,BRL,PEN";
    const res2 = await fetch(url);
    const data2 = await res2.json();
    ratesUSD = data2.rates;
    ratesUSD["USD"] = 1; // USD a USD = 1

    apiError = false;
  } catch (e) {
    apiError = true;
  }
}

function calcularResultados(monto, monedaInput) {
  if(apiError) return monedas.map(() => "NaN");
  let resultados = [];
  let usd;
  if(monedaInput === "BOB") {
    usd = parseFloat(monto) * rateBOBtoUSD;
  } else if(monedaInput === "USD") {
    usd = parseFloat(monto);
  } else {
    // Primero convertir a USD
    usd = parseFloat(monto) / (ratesUSD[monedaInput] || 1);
  }
  for(let m of monedas) {
    if(m.code === "BOB") {
      resultados.push((usd / rateBOBtoUSD).toLocaleString(undefined, {maximumFractionDigits:4}));
    } else if(m.code === "USD") {
      resultados.push(usd.toLocaleString(undefined, {maximumFractionDigits:4}));
    } else {
      let valor = usd * (ratesUSD[m.code] || 1);
      resultados.push(valor.toLocaleString(undefined, {maximumFractionDigits:4}));
    }
  }
  return resultados;
}

// Render simple vanilla JS para evitar conflictos de dependencias
function render() {
  document.getElementById("root").innerHTML = `
    <div class="flex flex-col items-center min-h-screen w-screen justify-center">
      <div class="w-full max-w-[430px] bg-[#1A1A1A] rounded-3xl shadow-xl p-2 pt-5 mx-auto">
        <div class="flex items-center gap-2 px-4 text-white/70">
          <span class="text-3xl">⭐</span>
          <span class="ml-2 font-semibold text-lg">Basic</span>
          <span class="ml-5 font-semibold text-lg">Scientific</span>
          <span class="ml-5 font-semibold text-lg text-[#F6B13A] bg-black/40 px-3 py-1 rounded-2xl">Currency</span>
          <span class="ml-auto text-2xl">⚙️</span>
        </div>
        ${apiError ? `<div class="text-center text-red-400 my-6">No se pudo conectar a las APIs. Intenta de nuevo.</div>` : ""}
        <div class="flex flex-col gap-2 my-4">
          ${monedas.map((m,idx)=>`
            <div class="flex items-center bg-[#232323] rounded-2xl p-2 min-h-[60px] shadow-inner border border-[#222]">
              <img src="${m.flag}" class="w-10 h-7 rounded border border-neutral-700 mr-3">
              <div class="flex-1 flex flex-col">
                <span class="text-xl md:text-2xl text-white/90 tracking-widest">${m.code}</span>
                <span class="text-neutral-400 text-xs md:text-base">${m.name}</span>
              </div>
              <input 
                type="number" 
                inputmode="decimal"
                step="any"
                min="0"
                id="input-${m.code}"
                value="${lastInput === m.code ? inputAmount : calcularResultados(inputAmount,lastInput)[idx]}"
                class="bg-transparent text-right text-white text-2xl w-28 md:w-32 outline-none px-2 font-bold font-mono ${lastInput===m.code?"border-b-2 border-[#F6B13A]":""}"
                style="caret-color: #F6B13A"
                ${apiError?'disabled':''}
                onchange="onInputChange('${m.code}',this.value)"
                onfocus="onInputFocus('${m.code}')"
              >
            </div>
          `).join("")}
        </div>
      </div>
    </div>
    <script>
      function onInputChange(code, val){
        window.lastInput = code;
        window.inputAmount = val;
        window.render();
      }
      function onInputFocus(code){
        window.lastInput = code;
        window.render();
        setTimeout(()=>{document.getElementById("input-"+code).select()},10);
      }
    </script>
  `;
}
window.onInputChange = (code, val) => { lastInput=code; inputAmount=val; render(); }
window.onInputFocus = (code) => { lastInput=code; render(); setTimeout(()=>{document.getElementById("input-"+code).select()},10);}
window.addEventListener('DOMContentLoaded', async ()=>{
  await cargarTasas();
  render();
});
</script>
</body>
</html>
