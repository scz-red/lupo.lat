<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Currency Calculator iPhone Style</title>
  <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #232323; font-family: 'SF Pro Display', Arial, sans-serif; }
    .noselect { user-select: none; }
    html, body { height: 100%; margin: 0; }
  </style>
</head>
<body class="noselect">
  <div id="root"></div>
  <script>
    // Flags y datos de las monedas
    const currencies = [
      { code: "BOB", name: "Boliviano", flag: "https://flagcdn.com/bo.svg" },
      { code: "USD", name: "Dólar estadounidense", flag: "https://flagcdn.com/us.svg" },
      { code: "EUR", name: "Euro", flag: "https://flagcdn.com/eu.svg" },
      { code: "GBP", name: "Libra Esterlina", flag: "https://flagcdn.com/gb.svg" },
      { code: "ARS", name: "Peso Argentino", flag: "https://flagcdn.com/ar.svg" },
      { code: "CLP", name: "Peso Chileno", flag: "https://flagcdn.com/cl.svg" },
      { code: "BRL", name: "Real Brasileño", flag: "https://flagcdn.com/br.svg" },
      { code: "PEN", name: "Sol Peruano", flag: "https://flagcdn.com/pe.svg" },
      { code: "CNY", name: "Yuan Chino", flag: "https://flagcdn.com/cn.svg" }
    ];

    const apiDolar = "https://dolar-api-bolivia.onrender.com/dolar-paralelo";
    const apiFx = "https://api.exchangerate.host/latest?base=USD&symbols=EUR,GBP,ARS,CLP,BRL,PEN,CNY";

    let usdToBob = 0; // 1 USD = ? BOB

    // Numpad y lógica básica
    const numPad = [
      ["7", "8", "9", "/"],
      ["4", "5", "6", "x"],
      ["1", "2", "3", "-"],
      ["C", "0", ".", "+"],
    ];

    let input = "1";
    let rates = {}; // { EUR: 0.92, ... }
    let loading = true;
    let error = "";

    // Render inicial y actualización
    async function initApp() {
      loading = true; error = "";
      render();
      try {
        // 1. Fetch tu API para saber cuánto es 1 USD en BOB
        const res = await fetch(apiDolar);
        const data = await res.json();
        usdToBob = Number(data.compra_bs) || 0;
        // 2. Fetch exchangerate.host para USD → resto de monedas
        const fx = await fetch(apiFx).then(r=>r.json());
        rates = fx.rates;
        loading = false;
        render();
      } catch(e) {
        error = "No se pudo conectar a las APIs. Intenta de nuevo.";
        loading = false;
        render();
      }
    }

    function calcularValores(bob) {
      // Si falta la tasa, retorna vacío
      if (!usdToBob || !rates || !rates.EUR) return {};
      // Siempre primero boliviano → USD con tu API
      const usd = bob / usdToBob;
      const result = { BOB: bob, USD: usd };
      // El resto: USD * tasa respectiva
      Object.entries(rates).forEach(([code, tasa])=>{
        result[code] = usd * tasa;
      });
      return result;
    }

    function handlePress(val) {
      if (val === "C") {
        input = "";
        render();
        return;
      }
      if (["+", "-", "x", "/"].includes(val)) {
        if (!input || /[+\-x\/]$/.test(input)) return;
        input += val;
        render();
        return;
      }
      if (val === ".") {
        if (input.includes(".") || /[+\-x\/]$/.test(input.slice(-1))) return;
        input += ".";
        render();
        return;
      }
      input = input === "0" ? val : input + val;
      render();
    }

    function render() {
      document.getElementById("root").innerHTML = `
      <div class="bg-[#232323] flex items-center justify-center min-h-screen">
        <div class="w-full max-w-[430px] mx-auto min-h-screen flex flex-col" style="box-shadow:0 0 30px #0008; border-radius:32px;">
          <div class="flex items-center gap-2 pt-4 px-4 text-white/60">
            <span style="font-size:1.8rem;">&#11088;</span>
            <span class="ml-2 font-semibold text-lg">Basic</span>
            <span class="ml-5 font-semibold text-lg">Scientific</span>
            <span class="ml-5 font-semibold text-lg text-[#F6B13A] bg-black/40 px-3 py-1 rounded-2xl">Currency</span>
            <span class="ml-auto" style="font-size:1.8rem;">&#9881;</span>
          </div>
          <div class="flex-1 flex flex-col justify-end pb-2 px-2 md:px-8">
            ${error?`<div class="text-red-400 text-center py-3">${error}</div>`:""}
            ${loading?`<div class="text-gray-300 text-center py-3">Cargando tasas de cambio...</div>`:""}
            ${!loading && !error ? currencies.map(c=>{
              // Calcula el valor
              let n = 0;
              try {
                let evalStr = input.replace(/x/g,"*").replace(/\//g,"/");
                n = eval(evalStr) || 0;
              } catch { n = 0; }
              const res = calcularValores(n);
              let val = res[c.code];
              return `
              <div class="flex items-center bg-[#303030] rounded-2xl mb-3 p-3 min-h-[70px] shadow-inner border border-[#222]">
                <img src="${c.flag}" class="w-12 h-8 rounded shadow border border-neutral-700 mr-3">
                <div class="flex-1 flex flex-col">
                  <span class="text-[2rem] text-white/80 font-[SF Pro Display] tracking-widest">${c.code}</span>
                  <span class="text-neutral-400 text-[15px] font-normal -mt-2">${c.name}</span>
                </div>
                <div class="flex flex-col items-end">
                  <span class="text-white text-[2rem] font-bold font-mono">${typeof val !== "undefined" && !isNaN(val)? val.toLocaleString(undefined, {maximumFractionDigits: 4}):"--"}</span>
                </div>
              </div>
              `;
            }).join("") : ""}
          </div>
          <div class="pb-4 px-1 md:px-6">
            <div class="grid grid-cols-4 gap-3">
              ${numPad.flat().map((n,i)=>`
                <button class="rounded-[1.3rem] h-16 md:h-20 text-3xl font-bold shadow-sm transition active:bg-[#383838] active:scale-95
                  ${["+", "-", "x", "/"].includes(n) ? "bg-[#FF9200] text-white" : n==="C"?"bg-[#383838] text-[#FF9200]":"bg-[#292929] text-white"}"
                  onclick="handlePress('${n}')"
                >${n}</button>
              `).join("")}
            </div>
          </div>
        </div>
      </div>
      `;
    }

    window.handlePress = handlePress;
    initApp();
  </script>
</body>
</html>
