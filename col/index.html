<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Currency Calculator</title>
  <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { height: 100%; margin:0; background: #232323; font-family: 'SF Pro Display', Arial, sans-serif;}
    .noselect { user-select: none; }
    @media (max-width:430px) {
      .no-scroll { overflow:hidden; height:100dvh;}
    }
    .gear-btn {
      position: absolute; top: 14px; right: 20px; z-index: 30;
      background: none; border: none; outline: none;
    }
    .gear-btn svg {
      width: 32px; height: 32px; fill: #FF9200;
      transition: transform 0.2s;
    }
    .gear-btn:active svg { transform: rotate(60deg);}
    .modal-bg {
      background: rgba(20,20,20,0.8);
      position: fixed; inset: 0; z-index: 50;
      display: flex; align-items: center; justify-content: center;
    }
  </style>
</head>
<body class="noselect no-scroll">
  <div id="root"></div>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script type="text/javascript">
    const { useState, useEffect } = React;

    const allCurrencies = [
      { code: "USD", name: "Dólar", flag: "https://flagcdn.com/us.svg" },
      { code: "EUR", name: "Euro", flag: "https://flagcdn.com/eu.svg" },
      { code: "COP", name: "Peso colombiano", flag: "https://flagcdn.com/co.svg" },
      { code: "CLP", name: "Peso chileno", flag: "https://flagcdn.com/cl.svg" },
      { code: "PEN", name: "Sol peruano", flag: "https://flagcdn.com/pe.svg" },
      { code: "BRL", name: "Real brasileño", flag: "https://flagcdn.com/br.svg" },
      { code: "CNY", name: "Yuan chino", flag: "https://flagcdn.com/cn.svg" },
      { code: "ARS", name: "Peso argentino", flag: "https://flagcdn.com/ar.svg" },
      { code: "GBP", name: "Libra esterlina", flag: "https://flagcdn.com/gb.svg" },
      { code: "BTC", name: "Bitcoin", flag: "https://cryptologos.cc/logos/bitcoin-btc-logo.svg?v=030", type: "crypto" },
      { code: "ETH", name: "Ethereum", flag: "https://cryptologos.cc/logos/ethereum-eth-logo.svg?v=030", type: "crypto" },
      { code: "SOL", name: "Solana", flag: "https://cryptologos.cc/logos/solana-sol-logo.svg?v=030", type: "crypto" },
      { code: "USDT", name: "Tether", flag: "https://cryptologos.cc/logos/tether-usdt-logo.svg?v=030", type: "crypto" }
    ];

    const fallbackRates = {
      USD_BOB: 14,
      USD: 1,
      EUR: 0.85,
      COP: 4030,
      CLP: 950,
      PEN: 3.7,
      BRL: 5.6,
      CNY: 7.25,
      ARS: 1278,
      GBP: 0.74,
      BTC: 0.000016,
      ETH: 0.00030,
      SOL: 0.013,
      USDT: 1
    };

    const numPad = [
      ["7", "8", "9", "/"],
      ["4", "5", "6", "x"],
      ["1", "2", "3", "-"],
      ["C", "0", ".", "+"],
    ];

    // Para favoritos persistentes
    function loadFavorites() {
      try {
        const fav = JSON.parse(localStorage.getItem("favcurrencies"));
        if (Array.isArray(fav) && fav.length) return fav;
      } catch {}
      // Default favoritas si no hay
      return ["USD","EUR","COP","BTC","ETH","USDT"];
    }
    function saveFavorites(fav) {
      localStorage.setItem("favcurrencies", JSON.stringify(fav));
    }

    function CurrencyCalculatorApp() {
      const [input, setInput] = useState("100");
      const [rates, setRates] = useState({ ...fallbackRates });
      const [showModal, setShowModal] = useState(false);
      const [favorites, setFavorites] = useState(loadFavorites());

      // Guardar favoritos persistentes
      useEffect(() => { saveFavorites(favorites); }, [favorites]);

      // Fetch dólar paralelo BOB/USD
      useEffect(() => {
        fetch("https://dolar-api-bolivia.onrender.com/venta")
          .then(res => res.json())
          .then(data => {
            if (data && data.promedio_bs) {
              setRates(r => ({ ...r, USD_BOB: parseFloat(data.promedio_bs) }));
            }
          }).catch(() => { });
      }, []);

      // Fetch tasas internacionales (USD->otras monedas)
      useEffect(() => {
        fetch("https://api.frankfurter.app/latest?from=USD&to=EUR,COP,CLP,PEN,BRL,CNY,ARS,GBP")
          .then(res => res.json())
          .then(data => {
            if (data && data.rates) {
              setRates(r => ({
                ...r,
                EUR: data.rates.EUR || r.EUR,
                COP: data.rates.COP || r.COP,
                CLP: data.rates.CLP || r.CLP,
                PEN: data.rates.PEN || r.PEN,
                BRL: data.rates.BRL || r.BRL,
                CNY: data.rates.CNY || r.CNY,
                ARS: data.rates.ARS || r.ARS,
                GBP: data.rates.GBP || r.GBP
              }));
            }
          }).catch(() => { });
      }, []);

      // Criptomonedas (USD → crypto)
      useEffect(() => {
        fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana,tether&vs_currencies=usd")
          .then(res => res.json())
          .then(data => {
            if (data) {
              setRates(r => ({
                ...r,
                BTC: 1 / data.bitcoin.usd,
                ETH: 1 / data.ethereum.usd,
                SOL: 1 / data.solana.usd,
                USDT: 1 / data.tether.usd
              }));
            }
          }).catch(() => { });
      }, []);

      function handlePress(val) {
        if (val === "C") { setInput(""); return; }
        if (["+", "-", "x", "/"].includes(val)) return;
        if (val === ".") {
          if (!input || input.includes(".")) return;
          setInput(inp => inp + ".");
          return;
        }
        setInput(inp => {
          if (inp === "0") return val;
          if (inp.length > 12) return inp;
          return inp + val;
        });
      }

      function handleInputChange(e) {
        let v = e.target.value.replace(",",".").replace(/[^0-9.]/g,"");
        setInput(v);
      }

      // Lógica cruzada: BOB → USD paralelo → moneda/cripto
      function getResults() {
        let bob = parseFloat(input.replace(",", ".")) || 0;
        let usd = bob / rates.USD_BOB;
        let res = {};
        allCurrencies.forEach(c=>{
          if(c.code==="USD") res[c.code]=usd.toLocaleString(undefined, { maximumFractionDigits: 2 });
          else if(c.type==="crypto")
            res[c.code]=(usd * rates[c.code]).toLocaleString(undefined, { maximumFractionDigits: 8 });
          else
            res[c.code]=(usd * rates[c.code]).toLocaleString(undefined, { maximumFractionDigits: (c.code==="COP"||c.code==="CLP"||c.code==="ARS"?0:2)});
        });
        return res;
      }

      const result = getResults();

      // Lista de favoritas reales (siempre existen)
      const favoriteList = allCurrencies.filter(c => favorites.includes(c.code));

      // Modal de selección favoritas
      function FavModal() {
        return (
          React.createElement("div",{className:"modal-bg"},
            React.createElement("div",{className:"bg-[#181818] rounded-2xl p-5 w-[94vw] max-w-md border border-[#393939]"},
              React.createElement("div",{className:"text-xl mb-2 font-bold text-white"},"Elige tus monedas favoritas"),
              React.createElement("div",{className:"flex flex-wrap gap-2 mb-4"},
                allCurrencies.map(c =>
                  React.createElement("button",{
                    key:c.code,
                    onClick:()=>setFavorites(favs=>{
                      if(favs.includes(c.code)) return favs.filter(f=>f!==c.code);
                      return [...favs, c.code];
                    }),
                    className:"flex items-center px-3 py-2 rounded-xl border " +
                      (favorites.includes(c.code)?"bg-[#FF9200] border-[#FF9200] text-white":"bg-[#292929] border-[#393939] text-white/80")
                  },
                    React.createElement("img",{src:c.flag,className:"w-6 h-4 mr-2 rounded shadow"}),
                    React.createElement("span",{className:"font-semibold"},c.code)
                  )
                )
              ),
              React.createElement("button",{
                className:"w-full bg-[#FF9200] text-white py-2 rounded-xl font-bold text-lg mt-2 active:scale-95",
                onClick:()=>setShowModal(false)
              },"Guardar y cerrar")
            )
          )
        );
      }

      return (
        React.createElement("div",{className:"flex flex-col w-full h-[100dvh] items-center justify-between bg-[#232323] px-0 py-0 relative"},
          // Barra superior input
          React.createElement("div",{className:"w-full flex justify-center py-3 bg-[#232323] sticky top-0 z-20 relative"},
            React.createElement("div",{className:"flex items-center w-[94vw] max-w-sm rounded-2xl bg-[#292929] border border-[#393939] px-4 py-2 shadow"},
              React.createElement("img",{src:"https://flagcdn.com/bo.svg",className:"w-8 h-5 rounded shadow mr-3"}),
              React.createElement("input",{
                className:"flex-1 bg-transparent text-[#FF9200] text-3xl font-mono font-bold outline-none border-none select-all",
                value:input,
                inputMode:"decimal",
                pattern:"[0-9]*",
                maxLength:12,
                onChange:handleInputChange
              }),
              React.createElement("span",{className:"text-white/60 ml-2 font-bold tracking-wide"},"BOB")
            ),
            React.createElement("button",{className:"gear-btn",title:"Elegir monedas",onClick:()=>setShowModal(true)},
              React.createElement("svg",{viewBox:"0 0 24 24"},
                React.createElement("path",{d:"M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7zm7.43-2.38c.04-.39.07-.79.07-1.12 0-.33-.03-.73-.07-1.12l2.11-1.65a.54.54 0 0 0 .13-.68l-2-3.46a.52.52 0 0 0-.61-.25l-2.49 1a7.28 7.28 0 0 0-1.92-1.12l-.38-2.65A.52.52 0 0 0 13.5 2h-4a.52.52 0 0 0-.52.43l-.38 2.65c-.7.26-1.36.63-1.92 1.12l-2.49-1a.5.5 0 0 0-.61.25l-2 3.46a.54.54 0 0 0 .13.68l2.11 1.65c-.04.39-.07.79-.07 1.12 0 .33.03.73.07 1.12l-2.11 1.65a.54.54 0 0 0-.13.68l2 3.46c.13.21.4.3.61.25l2.49-1c.6.46 1.25.86 1.92 1.12l.38 2.65c.06.25.28.43.52.43h4c.24 0 .46-.18.52-.43l.38-2.65a7.28 7.28 0 0 0 1.92-1.12l2.49 1c.22.09.48-.04.61-.25l2-3.46a.54.54 0 0 0-.13-.68l-2.11-1.65z"})
              )
            )
          ),
          // Tarjetas monedas favoritas
          React.createElement("div",{className:"w-full flex-1 flex flex-col items-center overflow-y-auto pt-2 pb-2"},
            favoriteList.map((c,idx)=>
              React.createElement("div",{
                key:c.code,
                className:"flex items-center bg-[#292929] rounded-xl mb-2 px-3 py-2 w-[94vw] max-w-sm min-h-[48px] shadow border border-[#232323]"
              },
                React.createElement("img",{src:c.flag,className:"w-8 h-5 rounded shadow mr-3"}),
                React.createElement("span",{className:"text-white/90 text-lg w-14 font-bold"},c.code),
                React.createElement("span",{className:"text-neutral-400 text-xs flex-1 truncate"},c.name),
                React.createElement("span",{className:"text-white text-2xl font-bold font-mono ml-3 tracking-wide"},
                  result[c.code] || "—"
                )
              )
            )
          ),
          // Modal de selección
          showModal && React.createElement(FavModal,null),
          // Teclado
          React.createElement("div",{className:"w-full pb-2 bg-[#232323] flex justify-center"},
            React.createElement("div",{className:"grid grid-cols-4 gap-2 w-[94vw] max-w-sm"},
              numPad.flat().map((n, i) =>
                React.createElement("button", {
                  key: i,
                  className: `rounded-xl h-12 text-2xl font-bold shadow-md transition active:bg-[#383838] active:scale-95 ${
                    n === "+" || n === "-" || n === "x" || n === "/"
                      ? "bg-[#FF9200] text-white"
                      : n === "C"
                      ? "bg-[#383838] text-[#FF9200]"
                      : "bg-[#292929] text-white"
                  }`,
                  onClick: () => handlePress(n)
                }, n)
              )
            )
          )
        )
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(CurrencyCalculatorApp));
  </script>
</body>
</html>
